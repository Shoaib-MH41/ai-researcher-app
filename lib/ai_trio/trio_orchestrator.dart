import 'package:flutter/foundation.dart';
import '../models/research_model.dart';
import 'research_ai.dart';
import 'lab_testing_ai.dart';
import 'medanalyzer_ai.dart';
import 'curesynth_ai.dart';
import 'biomind_ai.dart';
import 'report_ai.dart';

/// ğŸ¯ TrioOrchestrator â€”
/// ÛŒÛ Ú©Ù„Ø§Ø³ Ù…Ø®ØªÙ„Ù AI Ù…Ø§ÚˆÛŒÙˆÙ„Ø² Ú©Û’ Ø¯Ø±Ù…ÛŒØ§Ù† Ú©Ø§Ù… Ú©Ùˆ ØªÙ‚Ø³ÛŒÙ… Ú©Ø±ØªÛŒ ÛÛ’ Ø§ÙˆØ±
/// ØªÙ…Ø§Ù… data Ú©Ùˆ Ø§ÛŒÚ© Ù…Ú©Ù…Ù„ research Ø±Ù¾ÙˆØ±Ù¹ Ù…ÛŒÚº merge Ú©Ø± Ø¯ÛŒØªÛŒ ÛÛ’Û”
class TrioOrchestrator {
  /// ğŸ”¬ Ù…Ú©Ù…Ù„ Ø±ÛŒØ³Ø±Ú† Ú†Ù„Ø§Ù†Û’ Ú©Ø§ Ù…Ø±Ú©Ø²ÛŒ ÙÙ†Ú©Ø´Ù†
  static Future<MedicalResearch> runFullResearchPipeline({
    required String topic,
    required String hypothesis,
  }) async {
    debugPrint('ğŸ§  [TrioOrchestrator] Starting research pipeline for: $topic');

    // Step 1: Research AI â€” Ù…ÙˆØ¶ÙˆØ¹ Ú©ÛŒ Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªØ­Ù‚ÛŒÙ‚
    final researchData = await ResearchAI.generateResearchSummary(
      topic: topic,
      hypothesis: hypothesis,
    );

    // Step 2: Lab Testing AI â€” Ù†ØªØ§Ø¦Ø¬ Ú©Ø§ Ø³Ø§Ø¦Ù†Ø³ÛŒ ØªØ¬Ø²ÛŒÛ
    final labResults = await LabTestingAI.runLabAnalysis(
      researchSummary: researchData['summary'],
    );

    // Step 3: MedAnalyzer â€” Ù…ÛŒÚˆÛŒÚ©Ù„ ØªØ´Ø®ÛŒØµ Ø§ÙˆØ± Ù…Ø´Ø§ÛØ¯Ø§Øª
    final analysis = await MedAnalyzerAI.generateMedicalInsights(
      labData: labResults,
    );

    // Step 4: CureSynth â€” Ø¹Ù„Ø§Ø¬ ÛŒØ§ ØªÚ¾Ø±Ø§Ù¾ÛŒ Ú©ÛŒ ØªØ¬Ø§ÙˆÛŒØ²
    final curePlan = await CureSynthAI.generateTreatmentPlan(
      analysis: analysis,
    );

    // Step 5: BioMind â€” Ø­ÛŒØ§ØªÛŒØ§ØªÛŒ Ù¾ÛÙ„ÙˆØ¤Úº Ú©ÛŒ Ú¯ÛØ±ÛŒ ØªØ­Ù‚ÛŒÙ‚
    final bioFindings = await BioMindAI.runBiologicalResearch(
      topic: topic,
      relatedAnalysis: analysis,
    );

    // Step 6: Report AI â€” ØªÙ…Ø§Ù… data Ú©Ùˆ merge Ú©Ø± Ú©Û’ Ø§ÛŒÚ© Ø¬Ø§Ù…Ø¹ Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± Ú©Ø±Ù†Ø§
    final reportData = await ReportAI.generateCompleteReport(
      topic: topic,
      hypothesis: hypothesis,
      researchSummary: researchData['summary'],
      labResults: labResults,
      medicalAnalysis: analysis,
      treatmentPlan: curePlan,
      biologicalFindings: bioFindings,
    );

    // Final: Complete object build
    final research = MedicalResearch(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      topic: topic,
      hypothesis: hypothesis,
      methodology: 'Multi-AI Orchestrated Research Pipeline',
      labResults: labResults,
      analysis: analysis,
      conclusion: reportData['summary'] ?? 'Result generated by AI',
      pdfReport: reportData['pdf'] ?? '',
      createdAt: DateTime.now(),
      isAIResearch: true,
      aiDiscoveryData: {
        'ResearchAI': researchData,
        'LabTestingAI': labResults,
        'MedAnalyzerAI': analysis,
        'CureSynthAI': curePlan,
        'BioMindAI': bioFindings,
      },
    );

    debugPrint('âœ… [TrioOrchestrator] Research pipeline complete for: $topic');
    return research;
  }
}
