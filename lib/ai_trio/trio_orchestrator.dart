import 'package:flutter/foundation.dart';
import '../models/research_model.dart';
import 'research_ai.dart';
import 'lab_testing_ai.dart';
import 'medanalyzer_ai.dart';
import 'curesynth_ai.dart';
import 'biomind_ai.dart';
import 'report_ai.dart';

/// ğŸ¯ TrioOrchestrator â€”
/// Ù…Ø®ØªÙ„Ù AI Ù…Ø§ÚˆÛŒÙˆÙ„Ø² Ú©Ùˆ Ø¢Ù¾Ø³ Ù…ÛŒÚº coordinate Ú©Ø± Ú©Û’ Ù…Ú©Ù…Ù„ Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± Ú©Ø±ØªØ§ ÛÛ’Û”
class TrioOrchestrator {
  /// ğŸ”¬ Ù…Ø±Ú©Ø²ÛŒ ÙÙ†Ú©Ø´Ù† Ø¬Ùˆ ØªÙ…Ø§Ù… AI Ù…Ø±Ø§Ø­Ù„ Ú†Ù„Ø§ØªØ§ ÛÛ’
  static Future<MedicalResearch> runFullResearchPipeline({
    required String topic,
    required String hypothesis,
  }) async {
    debugPrint('ğŸ§  Starting AI Research Pipeline for $topic');

    // âœ… Step 1: Ø¨Ù†ÛŒØ§Ø¯ÛŒ ØªØ­Ù‚ÛŒÙ‚ - Ø¯Ø±Ø³Øª Ù…ÛŒØªÚ¾Úˆ Ù†Ø§Ù…
    final researchData = await ResearchAI.generateResearchSummary(
      topic: topic,
    );

    // âœ… Step 2: Ù„ÛŒØ¨ Ø§ÛŒÙ†Ø§Ù„ÛŒØ³Ø³ - Ø¯Ø±Ø³Øª Ù…ÛŒØªÚ¾Úˆ Ù†Ø§Ù…
    final labResults = await LabTestingAI.runLabAnalysis(
      researchData: researchData,
    );

    // âœ… Step 3: Ù…ÛŒÚˆÛŒÚ©Ù„ Ø§ÛŒÙ†Ø§Ù„ÛŒØ³Ø² - Ø¯Ø±Ø³Øª Ù…ÛŒØªÚ¾Úˆ Ù†Ø§Ù…
    final analysis = await MedAnalyzerAI.generateMedicalInsights(
      labResults: labResults,
      topic: topic,
    );

    // âœ… Step 4: Ø¹Ù„Ø§Ø¬ Ú©ÛŒ ØªØ¬Ø§ÙˆÛŒØ² - Ø¯Ø±Ø³Øª parameters
    final curePlan = await CureSynthAI.generateTreatmentPlan(
      medicalProblem: topic,
      analysisData: analysis,
    );

    // âœ… Step 5: Ø¨Ø§Ø¦ÛŒÙˆÙ„ÙˆØ¬ÛŒÚ©Ù„ ØªØ­Ù‚ÛŒÙ‚ - Ø¯Ø±Ø³Øª Ù…ÛŒØªÚ¾Úˆ Ù†Ø§Ù…
    final bioFindings = await BioMindAI.runBiologicalResearch(
      topic: topic,
      medicalData: analysis,
    );

    // âœ… Step 6: Ø±Ù¾ÙˆØ±Ù¹ ØªÛŒØ§Ø± Ú©Ø±Ù†Ø§ - Ø¯Ø±Ø³Øª parameters
    final reportData = await ReportAI.generateCompleteReport(
      topic: topic,
      hypothesis: hypothesis,
      researchSummary: researchData['summary'] ?? researchData.toString(),
      labResults: labResults,
      medicalAnalysis: analysis,
      treatmentPlan: curePlan,
      biologicalFindings: bioFindings,
    );

    // âœ… Ù…Ú©Ù…Ù„ MedicalResearch object
    final research = MedicalResearch(
      id: DateTime.now().millisecondsSinceEpoch.toString(),
      topic: topic,
      hypothesis: hypothesis,
      methodology: 'AI-Orchestrated Multi-Agent Pipeline',
      labResults: labResults.toString(),
      analysis: analysis.toString(),
      conclusion: reportData['summary'] ?? 'Generated by AI',
      pdfReport: reportData['pdfPath'] ?? '',
      createdAt: DateTime.now(),
      isAIResearch: true,
      aiDiscoveryData: {
        'research_ai': researchData,
        'lab_ai': labResults,
        'stats_ai': analysis,
        'treatment_ai': curePlan,
        'bio_ai': bioFindings,
      },
    );

    debugPrint('âœ… Research pipeline completed successfully.');
    return research;
  }

  /// ğŸ§© Ù¾Ø±Ø§Ù†Û’ Ú©ÙˆÚˆØ² Ú©Û’ Ù„ÛŒÛ’ compat method
  static Future<MedicalResearch> conductFullResearch(String topic) async {
    return await runFullResearchPipeline(
      topic: topic,
      hypothesis: 'Auto-generated hypothesis for $topic',
    );
  }
}
